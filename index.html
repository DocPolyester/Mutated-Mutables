<!DOCTYPE html>
<html>
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="chrome=1">
    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
    <link href='https://fonts.googleapis.com/css?family=Architects+Daughter' rel='stylesheet' type='text/css'>
    <link rel="stylesheet" type="text/css" href="stylesheets/stylesheet.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/pygment_trac.css" media="screen">
    <link rel="stylesheet" type="text/css" href="stylesheets/print.css" media="print">

    <!--[if lt IE 9]>
    <script src="//html5shiv.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->

    <title>Mutated Mutables by timchurches</title>
  </head>

  <body>
    <header>
      <div class="inner">
        <h1>Mutated Mutables</h1>
        <h2>Various enhancements, experiments and outright hacks of Mutable Instruments eurorack synth module firmware</h2>
        <a href="https://github.com/timchurches/Mutated-Mutables" class="button"><small>View project on</small> GitHub</a>
      </div>
    </header>

    <div id="content-wrapper">
      <div class="inner clearfix">
        <section id="main-content">

<p><a href="https://github.com/timchurches/Mutated-Mutables">This repository</a> is based on a copy of the Mutable Instruments GitHub repository at <a href="https://github.com/pichenettes/eurorack">https://github.com/pichenettes/eurorack</a></p>

<p>So far, the only modified code is the Bees-and-the-Trees enhancements to the <a href="http://mutable-instruments.net/modules/braids">Braids module</a>.</p>

<h1>
<a id="acknowledgements" class="anchor" href="#acknowledgements" aria-hidden="true"><span class="octicon octicon-link"></span></a>Acknowledgements</h1>

<p>First and foremost, huge thanks are due to <a href="https://media.licdn.com/mpr/mpr/shrink_500_500/p/4/005/041/08d/3190533.jpg">Olivier Gillet</a> of <a href="http://mutable-instruments.net">Mutable Instruments</a> for creating Braids and his other wonderful Eurorack synth modules - in terms of depth and breadth of creativity, elegance and excellence of implementation and execution, they are head-and-shoulders above other Eurorack synth modules. But equally huge thanks are due to Olivier for having the vision, courage and faith to release the designs and source code for his modules under open-source licenses. Without that, the modifications which are documented here would not have been possible.</p>

<p>Many thanks also to <a href="http://sneak-thief.com">Sneak-Thief</a> in Berlin, first of all for providing the impetus for me to start hacking the Braids code, and then for providing lots of really useful feedback on the initial design of the Bees-and-the-Trees modifications, and finally for actively testing the code and discovering several bugs (and documenting how to reproduce them!). Thanks are also due to <em>weliveincities</em>, <em>Bmhot</em>, <em>stevencrichton</em> and <em>stevenb</em> on the Mutable Instruments forum for testing alpha and beta versions, finding and reporting various bugs, and providing feedback.</p>

<h1>
<a id="Bees-and-the-Trees" class="anchor" href="#Bees-and-the-Trees" aria-hidden="true"><span class="octicon octicon-link"></span></a>Bees-and-the-Trees</h1>

<p>Bees-and-the-Trees is a modification to the "official" firmware as supplied by Mutable Instruments on the Braids modules it manufactures and sells.</p> 

<p>The goals of these modifications are to:</p>
<ul>
<li>expand the internal, self-modulation facilities in Braids;</li>
<li>expose a wider range of internal parameters to external voltage control;</li>
<li>add a few additional features that may make Braids more useful or easier to integrate into a modular patch in some circumstances.</li>
</ul>

<p>These enhancements are necessarily constrained by a number of factors:</p>
<ul>
<li>the hardware design of all existing Braids modules is obviously fixed, and thus the firmware must work with the hardware facilities available. For example, there are four CV inputs available in Braids. Firmware changes cannot create a fifth one. </li>
<li>the computational power of the STM32F3 processor which powers Braids is finite, and thus there is a limit to the amount and complexity of additional code and computations that can be added to the firmware while still allowing the processor to keep the audio buffer filled, in real-time.</li>
<li>the storage space for compiled program code in flash memory is limited to exactly 108 pages of 1024 bytes each - that is, 110,592 bytes. Thus there is a hard limit to the size and complexity of the firmware for Braids. In order to remain under this firmware size limit, some features have had to be removed from Braids to make space for the enhancements described below. See <a id="anti-enhancements" class="anchor" href="#anti-enhancements" aria-hidden="true">Anti-enhancements</a> below for details of what has been removed.</li>
</ul>

<p><img src="images/Bees-in-the-Trees.png" alt="Bees-in-the-Trees">Bees-and-the-Trees is based on the official Braids v1.7 source code, and has had the sync buffer and DAC timing bug fixes which were made to the v1.7 code in late January 2015 ported to it: thus the core oscillator code is identical to the current Braids v1.7 code. However, many changes to modulation options and other aspects have been made.</p>

<p>Why is it called <em>Bees-and-the-Trees</em>? Because Olivier Gillet named his alternative firmware for the <a href="http://mutable-instruments.net/modules/tides">Mutable Instruments Tides</a> module "<em><a href="http://mutable-instruments.net/modules/sheep/manual">Sheep</a></em>". That established a pattern which demanded to be followed.</p>


<h2>
<a id="Bees-and-the-Trees-audience" class="anchor" href="#Bees-and-the-Trees-audience" aria-hidden="true"><span class="octicon octicon-link"></span></a>Intended audience for Bees-and-the-Trees</h2>

<p>Bees-and-the-Trees is intended for expert users of the Braids module. It, and this documentation, presumes a good understanding of the way in which Braids running the  official, factory firmware works. If you have only recently obtained your Braids module, then it is strongly recommended that you spend some time (days, weeks, months) thoroughly familiarising yourself with it before trying Bees-and-the-Trees. Braids is a complex, deep module - it isn't called a <b><em>MacroOscillator</em></b> for nothing! Bees-and-the-Trees only makes it more complex. Also, this documentation is intended to be a <em>meta-manual</em>, to be read in conjunction with or as an adjunct to the <a href="http://mutable-instruments.net/modules/braids/manual">official Braids manual</a>.</p>

<h2>
<a id="Bees-and-the-Trees-version-3w-enhancements" class="anchor" href="#Bees-and-the-Trees-version-3w-enhancements" aria-hidden="true"><span class="octicon octicon-link"></span></a>Enhancements made by Bees-and-the-Trees</h2>

<ul>
<li>Instead of a single internal envelope, there are now two internal modulators, <code>MOD1</code> and <code>MOD2</code>. The <code>MOD1</code> and <code>MOD2</code> menu settings allow each internal modulator to be turned off (<b>OFF</b>), put in in LFO mode (<b>LFO</b>), or in one of two envelope modes (<b>ENV-</b> and <b>ENV+</b>). <b>ENV-</b> and <b>ENV+</b> are negative and positive envelopes respectively - <b>ENV+</b> is like a traditional attack-decay envelope, <b>ENV-</b> is the  inverse.</li>
<p>
<li>Each internal modulator has a rate setting, <code>RAT1</code> and <code>RAT2</code> respectively, with ranges from 0 to 127. When in envelope mode, lower rate values produce shorter envelope segment (attack and decay) durations, and higher rate values produce longer envelope segment durations i.e. slower envelopes. When in LFO mode, lower rate values produce slower LFO speeds (lower LFO frequency), and higher rate values produce faster speeds (higher frequencies), if the <code>RINV</code> (rate inversion) setting is <b>ON</b> (which is the default). However, if you turn <code>RINV</code> off, then higher <code>RAT1</code> or <code>RAT2</code> settings will produce slower LFO speeds. This can be useful if you are controlling one envelope and one LFO with an external voltage - see below.</li>
<p>
<li>Each internal modulator has five depth controls (<code>M1→T</code>, <code>M1→C</code>, <code>M1→L</code>, <code>M1→F</code> and <code>M1→J</code>, and <code>M2→T</code>, <code>M2→C</code>, <code>M2→L</code>, <code>M2→F</code> and <code>M2→J</code>), which set the depth of modulation for each of timbre, color, level (amplitude), frequency (pitch) and VCO jitter (drift), respectively, between values of 0 to 250, except for frequency modulation depth, which is 0 to 127. Each modulation destination receives a weighted average of the instantaneous modulator values. For example, if <code>M1→T</code>=30 and the instantaneous value of modulator 1 is, say, 100, and <code>M2→T</code>=60 and the instantaneous value of modulator 2 is 200, then the timbre parameter will receive a value of ((30 * 100) + (60 * 200))/2 = 7500. Obviously the values for modulator 1 and modulator 2 change each time the envelopes/LFOs are rendered, which is about 4000 times per second. </li>
<p>
<li>The timbre and color potentiometers and/or the timbre and color CV inputs act as offsets - the weighted average of the modulator values is added to these offsets. The <code>GAIN</code> setting controls the initial gain (offset) for the level. It defaults to 250 (the maximum). Unlike timbre and color, which are added to whatever offset is set by timbre and color potentiometers and/or the timbre and color CV inputs, the the modulation values for level are subtracted from this initial gain offset value (<code>GAIN</code>). Thus, when a modulator is in <b>ENV+</b> mode, it will have no effect of the output level if the <code>GAIN</code> is already set to 250, its maximum. In order to hear the effect of a positive-going envelope on level, you must reduce <code>GAIN</code> to a lower value - all the way down to zero if you wish to hear nothing between envelope firings.</li>
<p>
<li>The <code>M1→2</code> settings controls the degree of frequency modulation of modulator 2 by modulator 1. Yes, LFO 1 can frequency modulate LFO 2! This also works in envelope mode.</li>
<p>
<li><code>M1T2</code>, <code>M1C2</code> and <code>M1F2</code> are ON/OFF switches which determine whether the depth of modulation of timbre, color and pitch by modulator 2 is itself modulated by the current value of modulator 1. That is, when enabled, these settings mean that modulator 1 determines depth of modulator 2 modulation of timbre, color and oscillator frequency, respectively. Thus, if you set modulator 1 to be a slow envelope with a gentle attack, and set <code>M1F2</code> on, with <code>M2→F</code> set to some positive amount, and modulator 2 in LFO mode, then the effect will be vibrato that slowly fades in after a trigger is received. There are many other interesting variations possible.</li>
<p>
<li>The ratio between the attack and decay segments of each envelope, or the rising part of the waveform and the falling part in <b>LFO</b> mode, can be set by menu choices labelled <code>⇑⇓1</code> and <code>⇑⇓2</code>. These provide value choices ranging between 2 and 5000 (these are ratios expressed as a percentage, thus 100 is a ratio of 1:1). These values refer to the ratio between the duration of the attack segment of the attack-decay (AD) envelope, or the rising segment of the LFO waveform, and the duration of the decay segment or falling segment, respectively. Thus a value of 10 means that the attack part of the envelope is a tenth of the duration of the decay part. Likewise, at a setting of 10 the LFO waveform is asymmetrical, with the rising portion only one-tenth as long as the falling portion. Obviously a ratio setting of 100 produces a symmetrical waveform, and an envelope in which attack and decay are of equal duration. At a setting of 5000, the decay/falling arm of the envelope is 50 times as long as the attack/rising arm. <b>NOTE</b>: the LFO frequency or the total envelope duration will change as the <code>⇑⇓1</code> and <code>⇑⇓2</code> settings are adjusted. This is a known deficiency which may be able to be addressed in future versions. For now, you may need to re-adjust <code>RAT1</code> or <code>RAT2</code> after changing <code>⇑⇓1</code> and <code>⇑⇓2</code>.</li>
<p>
<li>Each of the two internal modulators has its own pair of shape settings (<code>⇑SH1</code> and <code>⇓SH1</code>, and <code>⇑SH2</code> and <code>⇓SH2</code>). These set the shape of the curve used for the attack/rising and decay/falling parts of the envelope/LFO waveform respectively, for each of modulator 1 and modulator 2. Thus, an envelope can have different shapes for the attack and decay portions, and an LFO waveform can not only be asymmetrical, but have a different curvature or shape on the raising and falling arms of its cycle. The following curve shapes are available:
<ul>
<li><b>EXPO</b> is an exponential curve, as used in the envelopes in the official Braids firmware;</li>
<li><b>LINR</b> is a linear curve i.e. a straight line (and thus in LFO mode produces sawtooth, triangle or ramp waveforms, depending on the <code>⇑⇓1</code> or <code>⇑⇓2</code> ratio settings);</li>
<li><b>WIGL</b> is a wiggly line;</li>
<li><b>SINE</b> is a sine wave (well, almost a sine wave - it re-uses an existing look-up table in the Braids code which is close to a sine wave);</li>
<li><b>SQRE</b> is a square-ish curve - a bandwidth-limited square wave with quite rounded shoulders, in fact; </li>
<li><b>BOWF</b> is a logarithmic curve with a flat top - it is actually an inverted version of the bowing envelope for the BOWD oscillator mode in Braids, hence the name; </li>
<li><b>RNDE</b> is the same as EXPO except that the target level for the top of the envelope or LFO waveform varies randomly on each envelope or LFO cycle; </li>
<li><b>RANDL</b> and <b>RNDS</b> are the same as <b>RNDE</b>, except using linear and square-ish curves as described above; </li>
<li><b>RNDM</b> sets a fixed random level which is flat for the entire envelope segment or LFO half-wave - thus it acts like a traditional clocked sample-and-hold sampling a random voltage. Please be aware that this mode can result in audible clicks when used for some modulation destinations, because the level shifts instantaneously - there is no rate-limiting or easing between successive levels.</li>
</ul>
</li>
<p>
<li>The <code>FMCV</code> setting replaces what was the <code>META</code> menu setting in the official Braids firmware. <code>FMCV</code> determines to what use the FM control voltage input is put. The available choices are: 
<ul>
<li><b>FREQ</b>, which means the FM input does, um, FM (frequency modulation);</li>
<li><b>META</b>, which is the same as <code>META</code> mode on in the official firmware - voltage on the FM input scans through the oscillator modes;</li>
<li><b>RATE</b>, in which voltage on the FM input sets the duration of the envelope segments, or the frequency of the LFOs - thus providing voltage-controlled envelopes and/or LFOs, with the FM voltage affecting the duration/speed of both internal modulators;</li>
<li><b>RAT1</b> is the same except the FM voltage only affects modulator 1;</li>
<li><b>RAT2</b> is also the same but the FM voltage only affects modulator 2. Note that for the rate settings, the voltage on the FM input is added to the <b>RAT1</b> and <b>RAT2</b> values for each each modulator, thus a base LFO speed or envelope duration can be set using <b>RAT1</b> and <b>RAT2</b>, and that can then be modified by voltage on the FM input.</li>
<li><b>JITR</b> provides voltage control over VCO jitter (drift), with a base level set by the <code>JITR</code> menu setting (and also subject to modulation by the internal modulators) via the <code>M1→J</code> and <code>M2→J</code> modulation depth settings.</li>
<li><b>LEVL</b> provides voltage control over the level (amplitude, gain). You may need to reduce the initial gain (<code>GAIN</code>) down to zero to hear the full effect - approximately 5V at the FM CV input should produce full gain. This setting provides Braids with a built-in virtual VCA, in the same way that the Level input in Tides/Sheep acts as a virtual VCA.</li>
</ul>
</li>
<p>
<li>LFO range has been enabled in the range (<code>RANG</code>) menu. This LFO range was always present in the Braids source code, but its selection was disabled. The LFO range seems to go down to about 1Hz or so - thus it doesn't make Braids into a proper LFO, but it is low enough for many LFO modulation duties. Braids certainly produces many more interesting LFO waveforms than your average voltage-controlled LFO, And of course the two internal LFOs can still modulate Braids when its set to LFO - thus you can use Braids as two voltage-controlled LFOs (<code>MOD1</code> and <code>MOD2</code>) inside your voltage-controlled LFO (the main Braids VCO when in LFO range)! </li>
<p>
<li><code>DRFT</code> (VCO drift) has been renamed <code>JITR</code> (jitter), and is now a settable value, from zero (off) to 127. At a setting of 127, you get noisy sonic destruction, but lower levels of jitter can add some nice dirt to some oscillator models. <code>JITR</code> is also now a destination for the internal modulators, as mentioned above, and it can also be put under voltage control via the <code>FMCV</code> setting. Note that <code>JITR</code> causes the oscillator pitch to change (not sure why), but this can be balanced out by applying pitch modulation from the same modulator (i.e. using <code>M1→F</code> or <code>M2→F</code>), because frequency modulation fortuitously acts in the opposite sense to the pitch change caused by <code>JITR</code>.</li>
<p>
<li>The <code>TSRC</code>, <code>TDLY</code>, <code>OCTV</code>, <code>QNTZ</code>, <code>BITS</code>, <code>BRIG</code>, <code>CAL.</code> and CV testing menu choices are unchanged and function exactly as they do in the official Braids firmware.</li>
<p>
<li>However, immediately following <code>QNTZ</code> (pitch quantisation), there is a new menu selection called <code>QVIB</code>, which stands for "quantise vibrato". It defaults to <b>OFF</b> - that is, vibrato from the internal modulators (or from the external FM input) is applied after pitch quantisation has been performed, if pitch quantisation is enabled (via the <code>QNTZ</code> setting). However, if <code>QVIB</code> is set to <b>ON</b>, then quantisation will be performed <b>after</b> pitch modulation from the internal modulators has been added. Thus, a triangle pitch (frequency) modulation, provided by, say, <code>MOD1</code> via the <code>M1→F</code> level, will result in rising and falling chromatic arpeggio effects, more or less. It can be quite effective when the RNDM modulator shape is used, for example.</li>
<p>
<li><code>M1SY</code> and <code>M2SY</code> (modulator 1 sync, and modulator 2 sync) determine whether a trigger (either external or auto) will reset the phase of modulator 1 or modulator 2, respectively. They default to <b>ON</b>. Tip: if you are using <code>MSEQ</code> (see below) and <code>MOD1</code> and/or <code>MOD2</code> in LFO mode to modulate timbre, color or other parameters, then try turning <code>M1SY</code> and/or <code>M2SY</code> off to decouple the internal modulators from the trigger stream driving the meta-sequencer.</li>
<p>
<li><code>OSYN</code> (oscillator sync) determines whether oscillator phase synchronisation is enabled or not. It defaults to <b>OFF</b>. When enabled, (external or auto) triggers may cause audible clicks in some oscillator modes. Disabling it prevents those clicks, at the expense of not resetting the oscillator phase. However, the official Braids firmware disables oscillator sync whenever the internal envelope was used, in any case, probably for the same reason.</li>
<p>
<li>A simple step meta-sequencer has been added. There are eight steps available in the sequence, and the sequence is advanced by triggers received on the trigger input jack. The <code>MSEQ</code> setting enables the meta-sequencer. The value of <code>MSEQ</code>, from 1 to 8, also sets the number of steps. The settings <code>MSQ1</code>, <code>MSQ2</code>...<code>MSQ8</code> allow the oscillator model for each step to be chosen. The settings <code>MSL1</code>, <code>MSL2</code>...<code>MSL8</code> determine the number of trigger inputs that each step is held for - all these settings default to 1. Thus, <code>MSL4</code>=3 means that the sequence of oscillator models will stay on step 4 for 3 successive input triggers. Using this, a "rhythm" of oscillator models can be set up, even when the triggers come from a regular clock signal. Note that if <code>MSEQ</code> is enabled, then <code>FMCV</code>=<b>META</b> mode is disabled if it is set. However, other <code>FMCV</code> modes still work when <code>MSEQ</code> is enabled.</li>
<p>
<li>There is a new oscillator model, called <b>ZERO</b>, right at the end of the model list, after <b>PRTC</b>. Don't get too excited, because this model fills the audio buffer with zeroes, and thus produces absolute silence. This was added to enable "rests" to be inserted in the <code>MSEQ</code> meta-sequencer. The downside is that there is an audible click when switching to it, because the signal amplitude immediately goes to zero. I can't think of any easy way to avoid this, however. The same problem occurs, to a lesser degree, and in the factory firmware as well, when switching to some of the other models, for similar reasons. Note that the ZERO model isn't accessible via <code>FMCV</code>=<b>META</b> mode.
</ul>

<p><img src="images/Bees-and-the-Trees-schematic-v3x-v001.png"></p>

<h1>
<a id="anti-enhancements" class="anchor" href="#anti-enhancements" aria-hidden="true"><span class="octicon octicon-link"></span></a>Anti-enhancements</h1>

<p>These changes were required in order to free up space in the firmware storage for the enhancements described above.</p>

<ul>
<li>A <em>paschal oophorectomy</em> has been performed: the Easter egg oscillator model has been removed and the ability to trigger Easter egg mode has been disabled. One could say that the code for it has been Pynchoned off. </li>
<li>The marquee feature has been removed.</li>
<li>The QPSK oscillator model has been removed.</li>
<li>The sample rate (<code>RATE</code>) setting has been removed. In Bees-and-the-Trees, Braids is locked at the maximum 96K sample rate instead. That isn't a problem from a CPU load perspective, because the sample rate reduction method didn't mean that the Braids processor was working less hard, just that it was discarding every second sample, or all but every third sample, or all but every fourth sample etc. However, the <code>BITS</code> setting is still there and still works, so you can still do bit-depth reduction for lo-fi grungy sounds, if that is your thing, and <code>JITR</code> (which is called <code>DRFT</code> in the factory Braids firmware) can now be cranked up to levels many times greater than before, for a really "dirty" sound. </li>
<li>VCO tune flattening (<code>FLAT</code>) and signature waveshapping (<code>SIGN</code>) have been removed.</li>
</ul>

<h1>
<a id="installation-and-de-installation" class="anchor" href="#installation-and-de-installation" aria-hidden="true"><span class="octicon octicon-link"></span></a>Installation and De-installation</h1>


<h2>
<a id="obligatory-warnings" class="anchor" href="#obligatory-warnings" aria-hidden="true"><span class="octicon octicon-link"></span></a>Obligatory warnings</a></h2>

<ol>
<li>As per the <a href-"https://github.com/timchurches/Mutated-Mutables/blob/master/braids/braids.cc">license text</a> at the top of every source code file for Bees-and-the-Trees, Bees-and-the-Trees is available for your use only if you accept the following terms:
<pre>
THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY 
OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT
LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT.
IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE
LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, 
WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, 
ARISING FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE
OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.
</pre>
</li>
<p></p>
<li>Installing Bees-and-the-Trees <b>will</b> reset the calibration data in your Braids, so you will need to re-calibrate it, using the (very straightforward) procedure described in the <a href="http://mutable-instruments.net/modules/braids/manual#calibration">Braids manual</a>. Likewise, re-installing official Braids firmware will also reset the calibration data, so you will need to re-calibrate yet again. However, it only takes a minute or so. But if you are not able to re-calibrate your Braids, then please do not install Bees-and-the-Trees!</li>
<p></p>
<li>If you want to re-install the official Braids firmware, then you <b>MUST</b> re-install the latest release in the v1.7 factory firmware series, which is here: <a href="http://mutable-instruments.net/static/firmware/braids_1.7.wav">http://mutable-instruments.net/static/firmware/braids_1.7.wav</a> – or a version of the factory firmware later than v1.7 if that is available. Do not re-install any of the earlier "release candidate" versions of v1.7 factory code, nor version 1.5 or earlier of the factory firmware. The reason is that only the very latest version of the official v1.7 Braids code contains the settings checking routine that ensures that re-installation of the official firmware after installing Bees-and-the-Trees (or other hacked code) will result is sane settings and a fully functional Braids. Of course, if there is a version of the official Braids firmware later than v1.7 available at the time you read this, then you should install that. The main thing to remember is that after installing Bees-and-the-Trees, you may experience problems if you try to re-install any version of the factory Braids firmware earlier than version 1.7. However, if you re-install version 1.7, it should be fine (all testing to date suggests that is the case, at least).</li> 
<p></p>
<li>You need to be aware that if you are installing Bees-and-the-Trees via the audio bootloader facilty then there is a very small chance that something may go wrong, either while installing Bees-and-the-Trees, or while re-installing the factory Braids firmware. Olivier Gillet has designed the audio bootloader to be highly failsafe, and almost foolproof, but nonetheless, there is a very small risk that you could end up with a non-functioning Braids due to a failed firmware upgrade (that is, your Braids ends up being "bricked"). If that happens, then I (Tim Churches) can offer only advice. I cannot offer an unbricking service, except to Braids users located in Sydney, and only then on a best-effort basis by prior negotiation. Thus, before trying Bees-and-the-Trees, you may wish to enquire whether there are other Braids users in the city or region where you live who are willing to re-install factory firmware for you using the FTDI or JTAG/SWD interfaces on Braids, just in case something does go wrong. I very much doubt that you will have any problems, but it is best to proceed cautiously. Note that installation of Bees-and-the-Trees, or any other firmware, cannot physically damage your Braids, so the module will always be recoverable if you have access to an FTDI or JTAG/SWD programmer as described <a href="http://mutable-instruments.net/modules/braids/open">here</a>.</li>
<p></p>
<li>Note also that the fine print in the Braids manual states that Olivier doesn’t offer an unbricking service for Braids that have had alternative firmware installed on them. That said, the likelihood of bricking your Braids when using the audio bootloader is very small – it has been designed to be failsafe and nearly idiot-proof.</li> 
</ol>
<p></p>
<p>OK, enough warnings.</p>

<p>If you have access to an FTDI interface or a suitable JTAG/SWD programmer, then you can just clone or download the Bees-and-the-Trees source code (use the HEAD commit from the master branch), compile it and flash it to your Braids. Instructions regarding this are <a href="http://mutable-instruments.net/modules/braids/open">here</a>.</p>

<p>If you are intending to use only the audio bootloader, then you should carefully follow the following steps:</p>

<ol>
<li>Use the audio bootloader, <a href="http://mutable-instruments.net/modules/braids/manual#firmware">as described in the Braids manual</a>, to first load the very latest Braids v1.7 firmware – see the link to it above. Verify that works correctly.</li>
<li>Practice the re-calibration procedure and verify that has worked.</li>
<li>Proceed to load the latest Bees-and-the-Trees version via the audio bootloader in the same way. Compiled firmware images in WAV format for Bees-and-the-Trees are available at (to be added when testing is complete).</li>
<li>Re-calibrate it.</li>
<li>Go crazy with it.</li>
</ol>

<p>You shouldn’t need to manually reset the stored settings if you follow this procedure – it should do that automatically when you install the Bees-and-the-Trees code (and likewise when you re-install the latest v1.7 or later factory firmware). However, if your Braids does seem confused, you can trigger a manual settings reset, in both the latest v1.7 firmware and in Bees-in-the-Trees, by navigating to the version string right at the end of the menu choices, and doing a long-click on the encoder. Warning: this also resets your calibration data, so you’ll need to re-calibrate yet again.</p>

<p>Re-installation of the factory Braids firmware is similar:</p>
<ol>
<li>Use the audio bootloader, <a href="http://mutable-instruments.net/modules/braids/manual#firmware">as described in the Braids manual</a>, to re-load the very latest Braids v1.7 firmware – see the link to it above. Verify that works correctly.</li>
<li>Re-calibrate it.</li>
</ol>

<h1>
<a id="to-do-and-roadmap" class="anchor" href="#to-do-and-roadmap" aria-hidden="true"><span class="octicon octicon-link"></span></a>TO-DO and Roadmap</h1>

<ul>
<li>PENDING: Work out why VCO drift (<code>JITR</code>) causes a pitch change.</li>
<li>PENDING: Prevent the LFO frequency or the total envelope duration from changing when the <code>⇑⇓1</code> and <code>⇑⇓2</code> settings are adjusted.</li>
<li>MAYBE: Some of the parameters in Bees-and-the-Trees have ranges of 0 to 250, and some 0 to 127. I did have some vague plans to rationalise that and make them all 0 to 127, or all 0 to 250, at least in the user interface. However, some use steps of 5, others use steps of 1, in order to provide very fine resolution. Those steps may need to be tweaked to minimise the need for encoder twisting, while retaining adequately fine control over critical parameters (pitch modulation and LFO rates in particular).</li>
<li>NOT FEASIBLE: It would be great to add a constrain-to-scales scales capability, similar to the one in Yarns or in the Shruthi and Ambika, to the pitch quantisation facility. However, such a feature requires various look-up tables, and there is just not enough flash storage space remaining - the firmware is almost at maximum size as it is.</li>
<li>NOT FEASIBLE: Alternatively, it might be possible to add a simple step sequencer to Braids, like the ones in the Anushri and in Yarns. However, there may not be enough room, and I am very reluctant to remove any more features or oscillator models from Bees-and-the-Trees to  accomodate it. Braids-with-built-in-sequencer might need to be a separate set of modifications resulting in different firmware yet again.</li>
</ul>

<h1>
<a id="encoder-direction" class="anchor" href="#encoder-direction" aria-hidden="true"><span class="octicon octicon-link"></span></a>Encoder direction</h1>

<p>Some crazy people have built DIY versions of Braids, and have used Bourns encoders in doing so. These operate in the opposite direction to those used by factory-built Braids modules. In order to accomodate this, <code>#define BACKWARDS_ENCODER</code> is set at the top of the <em>encoder.h</em> source code file. If you are compiling the source code yourself to load on a factory-built Braids, then you should ensure that this #define is commented out (place // in front of it on the same line). Failure to do that will mean that the encoder on your Braids will run backwards!</p>

<h1>
<a id="discussion" class="anchor" href="#discussion" aria-hidden="true"><span class="octicon octicon-link"></span></a>Discussion</h1>

<p>All these enhancements seem to work fine, but more extensive testing is always helpful. As mentioned above, Bees-and-the-Trees is intended for advanced users only, and assumes thorough familiarity with the way Braids operates. The modulators can interact with each other, by design, in complex and interesting ways (note that their values are summed for each destination, and the resulting sum is clipped - thus with the right offsets and modulation depths, you can achieve half-wave clipping effects etc). All of these substantially extend the range of sounds that can be coaxed out of a Braids, without using any other modules at all. Add a single external LFO or sequencer modulating the FM input, or a clock or trigger source stepping the MSEQ mode, and all sorts of really amazing things are possible. As such, Bees-and-the-Trees may be particularly useful in small systems where external modulation sources are few, but since it does not remove or subtract any vital or commonly-used existing Braids features or capabilities, it may be useful even in large systems.</p>

<p>Feedback and suggestions are welcome and appreciated - please email <a href="mailto:tim.churches@gmail.com">tim.churches@gmail.com</a></p>
        </section>

        <aside id="sidebar">
          <a href="https://github.com/timchurches/Mutated-Mutables/zipball/master" class="button">
            <small>Download</small>
            .zip file
          </a>
          <a href="https://github.com/timchurches/Mutated-Mutables/tarball/master" class="button">
            <small>Download</small>
            .tar.gz file
          </a>

          <p class="repo-owner"><a href="https://github.com/timchurches/Mutated-Mutables"></a> is maintained by <a href="https://github.com/timchurches">timchurches</a>.</p>

          <p>This page was generated by <a href="https://pages.github.com">GitHub Pages</a> using the Architect theme by <a href="https://twitter.com/jasonlong">Jason Long</a>.</p>
        </aside>
      </div>
    </div>

  
  </body>
</html>
